<!-- Preview: Lista + Detalle (AJAX snippet) -->

<div class="wb-preview-split">
  <!-- LISTA -->
  <div class="wb-preview-list">
    <div class="wb-preview-list__header">
      <strong>Lista</strong>
      <span class="wb-preview-list__hint">Haz clic en una tarjeta para ver el detalle</span>
    </div>

    <div class="wb-preview-grid">
      {% for item in items %}
      <div class="wb-preview-item js-preview-item {% if forloop.counter0 == selected_index %}is-selected{% endif %}"
           role="button"
           tabindex="0"
           data-index="{{ forloop.counter0 }}">

        {% if item.image %}
          <img src="{{ item.image }}" alt="{{ item.title }}" class="wb-preview-item__image">
        {% else %}
          <div class="wb-preview-item__image" style="display:flex;align-items:center;justify-content:center;background:#1a1a1a;">
            <span style="font-size:3rem;opacity:0.3;">ðŸ“„</span>
          </div>
        {% endif %}

        <div class="wb-preview-item__content">
          <h3 class="wb-preview-item__title">{{ item.title|truncatewords:10 }}</h3>

          {% if item.description %}
          <p class="wb-preview-item__description">
            {{ item.description|truncatewords:18 }}
          </p>
          {% endif %}

          {% if item.mapping_info %}
          <div class="wb-mapping-info">
            <div class="wb-mapping-info__title">ðŸ“‹ Mapping usado:</div>
            <div class="wb-mapping-info__fields">
              {% if item.mapping_info.title %}
              <span class="wb-mapping-badge">
                <span class="wb-mapping-badge__label">tÃ­tulo</span>
                <span class="wb-mapping-badge__value">{{ item.mapping_info.title }}</span>
              </span>
              {% endif %}

              {% if item.mapping_info.description %}
              <span class="wb-mapping-badge">
                <span class="wb-mapping-badge__label">descripciÃ³n</span>
                <span class="wb-mapping-badge__value">{{ item.mapping_info.description }}</span>
              </span>
              {% endif %}

              {% if item.mapping_info.link %}
              <span class="wb-mapping-badge">
                <span class="wb-mapping-badge__label">link</span>
                <span class="wb-mapping-badge__value">{{ item.mapping_info.link }}</span>
              </span>
              {% endif %}
            </div>
          </div>
          {% endif %}
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- DETALLE -->
  <div class="wb-preview-detail">
    <div class="wb-preview-detail__header">
      <strong>Detalle</strong>
      {% if selected_item %}
        <span class="wb-preview-detail__meta">Item #{{ selected_index|add:1 }}</span>
      {% endif %}
    </div>

    {% if not selected_item %}
      <div class="wb-message wb-message--warning">No hay items para mostrar.</div>
    {% else %}
      <div class="wb-preview-detail__card">
        <h2 class="wb-preview-detail__title">{{ selected_item.title }}</h2>

        {% if selected_item.image %}
          <img src="{{ selected_item.image }}" alt="{{ selected_item.title }}" class="wb-preview-detail__image">
        {% endif %}

        {% if selected_item.description %}
          <p class="wb-preview-detail__desc">{{ selected_item.description }}</p>
        {% endif %}

        {% if selected_item.link %}
          <a href="{{ selected_item.link }}" target="_blank" rel="noopener" class="wb-preview-detail__link">
            Abrir enlace â†’
          </a>
        {% endif %}

        <!-- Raw (Ãºtil para debug / TFG) -->
        <details class="wb-preview-detail__raw">
          <summary>Ver datos originales (raw)</summary>
          <pre>{{ selected_item.raw|pprint }}</pre>
        </details>
      </div>
    {% endif %}
  </div>
</div>
